<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ordem de Serviço</title>
  <style>
    /* Tema escuro */
    body {
      background-color: #121212;
      color: #eee;
      font-family: Arial, sans-serif;
      margin: 1em;
    }

    h1 {
      color: #fff;
    }

    label {
      display: block;
      margin-top: 0.5em;
      color: #ccc;
    }

    input[type=text], input[type=date], textarea {
      width: 100%;
      padding: 0.4em;
      margin-top: 0.2em;
      box-sizing: border-box;
      border-radius: 5px;
      border: 1px solid #444;
      background-color: #222;
      color: #eee;
    }

    textarea {
      resize: vertical;
    }

    /* Botões pretos arredondados com letras brancas */
    .btn {
      background-color: #000;
      color: #fff;
      border: none;
      padding: 0.6em 1.2em;
      font-size: 1em;
      cursor: pointer;
      border-radius: 12px;
      display: inline-flex;
      align-items: center;
      gap: 0.4em;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    .btn:hover {
      background-color: #222;
    }

    .btn svg {
      fill: #fff;
      width: 1.2em;
      height: 1.2em;
    }

    /* Container do formulário */
    .form-section {
      background: #1e1e1e;
      padding: 1em;
      margin-bottom: 1em;
      border-radius: 12px;
      box-shadow: 0 0 10px #000;
    }

    /* Histórico popup */
    #historicoPopup {
      display: none;
      position: fixed;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      background: #1e1e1e;
      border: 2px solid #333;
      padding: 1em;
      width: 350px;
      max-height: 450px;
      overflow-y: auto;
      box-shadow: 0 0 15px #000;
      z-index: 9999;
      border-radius: 12px;
    }

    #historicoPopup h2 {
      margin-top: 0;
      color: #fff;
      border-bottom: 1px solid #333;
      padding-bottom: 0.5em;
    }

    #listaHistorico div {
      padding: 0.5em;
      border-bottom: 1px solid #333;
      cursor: pointer;
      color: #ccc;
      user-select: none;
      font-size: 0.95em;
      border-radius: 8px;
      transition: background-color 0.2s ease;
    }

    #listaHistorico div:hover {
      background-color: #333;
      color: #fff;
    }

    /* Labels checkbox inline */
    label > input[type=checkbox] {
      margin-right: 0.4em;
    }
  </style>
</head>
<body onload="preencherDataEIncrementarOS()">

  <h1>Ordem de Serviço</h1>

  <div class="form-section">
    <p><strong>DATA:</strong> <span id="dataEntrada"></span></p>
    <p><strong>Nº da OS:</strong> <span id="osNumber"></span></p>

    <label for="nomeCliente">Nome do Cliente</label>
    <input type="text" id="nomeCliente" autocomplete="off" />

    <label for="telefone">Telefone</label>
    <input type="text" id="telefone" autocomplete="off" />

    <label><input type="checkbox" id="whatsapp" /> WhatsApp</label>

    <label for="tecnico">Técnico Responsável</label>
    <input type="text" id="tecnico" autocomplete="off" />

    <label for="marcaModelo">Marca e Modelo do Equipamento</label>
    <input type="text" id="marcaModelo" autocomplete="off" />

    <label>Acessórios:</label>
    <label><input type="checkbox" id="acessorioSim" /> Sim</label>
    <label><input type="checkbox" id="acessorioNao" /> Não</label>
    <div id="qualAcessorioLinha" style="display:none;">
      <label for="qualAcessorio">Qual acessório?</label>
      <textarea id="qualAcessorio" rows="2"></textarea>
    </div>

    <label>O equipamento liga?</label>
    <label><input type="checkbox" id="ligaSim" /> Sim</label>
    <label><input type="checkbox" id="ligaNao" /> Não</label>

    <label>Apresenta defeito?</label>
    <label><input type="checkbox" id="defeitoSim" /> Sim</label>
    <label><input type="checkbox" id="defeitoNao" /> Não</label>
    <div id="qualDefeitoLinha" style="display:none;">
      <label for="qualDefeito">Qual defeito?</label>
      <textarea id="qualDefeito" rows="2"></textarea>
    </div>

    <label for="defeitoCliente">Defeito informado pelo cliente</label>
    <textarea id="defeitoCliente" rows="2"></textarea>

    <label for="dataSaida">Data de retirada (prevista)</label>
    <input type="date" id="dataSaida" />

    <label for="assinaturaCliente">Assinatura do cliente</label>
    <input type="text" id="assinaturaCliente" autocomplete="off" />

    <label for="assinaturaTecnico">Assinatura do técnico</label>
    <input type="text" id="assinaturaTecnico" autocomplete="off" />

    <label for="senha">Senha (se houver)</label>
    <input type="text" id="senha" autocomplete="off" />
  </div>

  <button class="btn" onclick="window.print()">
    <svg viewBox="0 0 24 24"><path d="M6 9H18V15H6zM6 5H18V7H6zM6 17H18V19H6z"/></svg>
    IMPRIMIR ORDEM
  </button>

  <button class="btn" style="margin-left: 1em;" onclick="abrirHistorico()">
    <svg viewBox="0 0 24 24"><path d="M3 6h18M3 12h18M3 18h18"/></svg>
    HISTÓRICO
  </button>

  <div id="historicoPopup">
    <h2>Histórico de OS</h2>
    <div id="listaHistorico"></div>
    <button class="btn" style="margin-top: 1em; background-color: #444;" onclick="fecharHistorico()">Fechar</button>
  </div>

  <script>
    function preencherDataEIncrementarOS() {
      const hoje = new Date();
      const dataFormatada = hoje.toLocaleDateString('pt-BR');
      document.getElementById('dataEntrada').textContent = dataFormatada;

      let osAtual = parseInt(localStorage.getItem('osAtual') || '0', 10);
      osAtual++;
      localStorage.setItem('osAtual', osAtual);
      document.getElementById('osNumber').textContent = osAtual;

      limparFormulario();
    }

    function limparFormulario() {
      document.getElementById('nomeCliente').value = '';
      document.getElementById('telefone').value = '';
      document.getElementById('whatsapp').checked = false;
      document.getElementById('tecnico').value = '';
      document.getElementById('marcaModelo').value = '';
      document.getElementById('acessorioSim').checked = false;
      document.getElementById('acessorioNao').checked = false;
      document.getElementById('ligaSim').checked = false;
      document.getElementById('ligaNao').checked = false;
      document.getElementById('defeitoSim').checked = false;
      document.getElementById('defeitoNao').checked = false;
      document.getElementById('qualAcessorio').value = '';
      document.getElementById('qualDefeito').value = '';
      document.getElementById('qualAcessorioLinha').style.display = 'none';
      document.getElementById('qualDefeitoLinha').style.display = 'none';
      document.getElementById('defeitoCliente').value = '';
      document.getElementById('dataSaida').value = '';
      document.getElementById('assinaturaCliente').value = '';
      document.getElementById('assinaturaTecnico').value = '';
      document.getElementById('senha').value = '';
    }

    // Controle dos checkboxes para acessório e defeito (exclusivos)
    document.getElementById('acessorioSim').addEventListener('change', () => {
      const checked = document.getElementById('acessorioSim').checked;
      document.getElementById('qualAcessorioLinha').style.display = checked ? 'block' : 'none';
      if (!checked) document.getElementById('qualAcessorio').value = '';
      if (checked) document.getElementById('acessorioNao').checked = false;
    });
    document.getElementById('acessorioNao').addEventListener('change', () => {
      if (document.getElementById('acessorioNao').checked) {
        document.getElementById('acessorioSim').checked = false;
        document.getElementById('qualAcessorioLinha').style.display = 'none';
        document.getElementById('qualAcessorio').value = '';
      }
    });

    document.getElementById('defeitoSim').addEventListener('change', () => {
      const checked = document.getElementById('defeitoSim').checked;
      document.getElementById('qualDefeitoLinha').style.display = checked ? 'block' : 'none';
      if (!checked) document.getElementById('qualDefeito').value = '';
      if (checked) document.getElementById('defeitoNao').checked = false;
    });
    document.getElementById('defeitoNao').addEventListener('change', () => {
      if (document.getElementById('defeitoNao').checked) {
        document.getElementById('defeitoSim').checked = false;
        document.getElementById('qualDefeitoLinha').style.display = 'none';
        document.getElementById('qualDefeito').value = '';
      }
    });

    document.getElementById('ligaSim').addEventListener('change', () => {
      if (document.getElementById('ligaSim').checked) {
        document.getElementById('ligaNao').checked = false;
      }
    });
    document.getElementById('ligaNao').addEventListener('change', () => {
      if (document.getElementById('ligaNao').checked) {
        document.getElementById('ligaSim').checked = false;
      }
    });

    // Salvar no histórico ao imprimir
    window.onbeforeprint = function() {
      salvarOSNoHistorico();
    };

    function salvarOSNoHistorico() {
      const osNumber = document.getElementById('osNumber').textContent;
      const dataEntrada = document.getElementById('dataEntrada').textContent;

      const osDados = {
        osNumber,
        dataEntrada,
        nomeCliente: document.getElementById('nomeCliente').value,
        telefone: document.getElementById('telefone').value,
        whatsapp: document.getElementById('whatsapp').checked,
        tecnico: document.getElementById('tecnico').value,
        marcaModelo: document.getElementById('marcaModelo').value,
        acessorioSim: document.getElementById('acessorioSim').checked,
        acessorioNao: document.getElementById('acessorioNao').checked,
        ligaSim: document.getElementById('ligaSim').checked,
        ligaNao: document.getElementById('ligaNao').checked,
        defeitoSim: document.getElementById('defeitoSim').checked,
        defeitoNao: document.getElementById('defeitoNao').checked,
        qualAcessorio: document.getElementById('qualAcessorio').value,
        qualDefeito: document.getElementById('qualDefeito').value,
        defeitoCliente: document.getElementById('defeitoCliente').value,
        dataSaida: document.getElementById('dataSaida').value,
        assinaturaCliente: document.getElementById('assinaturaCliente').value,
        assinaturaTecnico: document.getElementById('assinaturaTecnico').value,
        senha: document.getElementById('senha').value,
        timestamp: new Date().getTime()
      };

      let historico = JSON.parse(localStorage.getItem('historicoOS') || '[]');

      // Remove OS antiga do mesmo número para evitar duplicidade
      historico = historico.filter(item => item.osNumber !== osNumber);

      historico.push(osDados);

      // Mantém todas as OSs salvas (sem limite)

      localStorage.setItem('historicoOS', JSON.stringify(historico));
    }

    function abrirHistorico() {
      const historico = JSON.parse(localStorage.getItem('historicoOS') || '[]');

      const lista = document.getElementById('listaHistorico');
      lista.innerHTML = '';

      // Ordena do mais recente para o mais antigo
      historico.sort((a, b) => b.timestamp - a.timestamp);

      if (historico.length === 0) {
        lista.innerHTML = '<p style="color:#888;">Nenhuma ordem de serviço salva.</p>';
      } else {
        historico.forEach(os => {
          const div = document.createElement('div');
          div.textContent = `${os.dataEntrada} - OS Nº ${os.osNumber} - ${os.nomeCliente || 'Cliente não informado'}`;
          div.title = 'Clique para editar esta OS';
          div.onclick = () => {
            fecharHistorico();
            carregarOSNoFormulario(os);
          };
          lista.appendChild(div);
        });
      }

      document.getElementById('historicoPopup').style.display = 'block';
    }

    function fecharHistorico() {
      document.getElementById('historicoPopup').style.display = 'none';
    }

    function carregarOSNoFormulario(os) {
      document.getElementById('dataEntrada').textContent = os.dataEntrada;
      document.getElementById('osNumber').textContent = os.osNumber;

      document.getElementById('nomeCliente').value = os.nomeCliente;
      document.getElementById('telefone').value = os.telefone;
      document.getElementById('whatsapp').checked = os.whatsapp;
      document.getElementById('tecnico').value = os.tecnico;
      document.getElementById('marcaModelo').value = os.marcaModelo;

      document.getElementById('acessorioSim').checked = os.acessorioSim;
      document.getElementById('acessorioNao').checked = os.acessorioNao;
      document.getElementById('qualAcessorioLinha').style.display = os.acessorioSim ? 'block' : 'none';
      document.getElementById('qualAcessorio').value = os.qualAcessorio || '';

      document.getElementById('ligaSim').checked = os.ligaSim;
      document.getElementById('ligaNao').checked = os.ligaNao;

      document.getElementById('defeitoSim').checked = os.defeitoSim;
      document.getElementById('defeitoNao').checked = os.defeitoNao;
      document.getElementById('qualDefeitoLinha').style.display = os.defeitoSim ? 'block' : 'none';
      document.getElementById('qualDefeito').value = os.qualDefeito || '';

      document.getElementById('defeitoCliente').value = os.defeitoCliente || '';
      document.getElementById('dataSaida').value = os.dataSaida || '';
      document.getElementById('assinaturaCliente').value = os.assinaturaCliente || '';
      document.getElementById('assinaturaTecnico').value = os.assinaturaTecnico || '';
      document.getElementById('senha').value = os.senha || '';
    }
  </script>

</body>
</html>
