<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Ordem de Serviço</title>
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: 'Times New Roman', Times, serif;
      padding: 20px;
    }

    .linha {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 8px;
      align-items: center;
    }

    .col {
      flex: 1;
      min-width: 150px;
    }

    .col-nome {
      flex: 2;
      min-width: 300px;
    }

    label {
      display: block;
      margin-bottom: 3px;
      font-weight: bold;
    }

    input[type="text"],
    textarea,
    select {
      width: 100%;
      padding: 5px;
      background-color: #111;
      color: #fff;
      border: 1px solid #555;
      font-family: inherit;
    }

    textarea {
      resize: vertical;
      min-height: 50px;
    }

    .checkbox-inline {
      display: inline-flex;
      align-items: center;
      margin-right: 10px;
    }

    /* Botões estilo similar à imagem */
    button, .btn {
      background-color: #0a3d62; /* azul escuro */
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 10px 18px;
      font-size: 14px;
      cursor: pointer;
      box-shadow: 0 3px 6px rgba(0,0,0,0.3);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button:hover, .btn:hover {
      background-color: #06527a;
    }
    button:active, .btn:active {
      background-color: #033e57;
    }
    button svg, .btn svg {
      width: 16px;
      height: 16px;
      fill: #fff;
    }

    .print-btn {
      margin-top: 20px;
    }

    hr {
      margin: 25px 0;
      border-color: #444;
    }

    @media print {
      body {
        background: #fff;
        color: #000;
      }
      .print-btn, button, #historicoBtn, #historicoPopup {
        display: none;
      }
      input, textarea, select {
        border: none;
        background: transparent;
        color: #000;
      }
      .linha {
        page-break-inside: avoid;
      }
      .termos-condicoes {
        display: block !important;
        page-break-before: always;
      }
    }

    .titulo {
      text-align: center;
      margin-bottom: 20px;
    }

    .contato {
      text-align: center;
      font-size: 18px;
      margin-top: 5px;
    }

    .hidden {
      display: none;
    }

    #historicoPopup {
      display: none;
      position: fixed;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      background: #222;
      color: #fff;
      padding: 20px;
      border: 2px solid #444;
      max-height: 70%;
      overflow-y: auto;
      z-index: 1000;
      width: 400px;
      border-radius: 8px;
    }

    #historicoBtn {
      position: absolute;
      top: 20px;
      right: 20px;
    }

    /* Lista do histórico */
    #listaHistorico div {
      padding: 8px 10px;
      border-bottom: 1px solid #444;
      cursor: pointer;
      border-radius: 4px;
    }
    #listaHistorico div:hover {
      background-color: #06527a;
    }
  </style>
</head>
<body onload="preencherDataEIncrementarOS()">

  <button class="btn" onclick="window.location.href='index.html'">
    <svg viewBox="0 0 24 24"><path d="M10 6 L8.59 7.41 13.17 12 8.59 16.59 10 18 16 12z"/></svg>
    INICIO
  </button>

  <button class="btn" id="historicoBtn" onclick="abrirHistorico()">
    <svg viewBox="0 0 24 24"><path d="M12 8v5l4 2"/></svg>
    Histórico de OS
  </button>

  <div id="historicoPopup">
    <h3>Histórico de OS (últimos 90 dias)</h3>
    <div id="listaHistorico"></div>
    <button class="btn" onclick="fecharHistorico()">
      <svg viewBox="0 0 24 24"><path d="M6 6l12 12M6 18L18 6"/></svg>
      Fechar
    </button>
  </div>

  <div class="titulo">
    <h1>CNT ASSISTÊNCIA TÉCNICA</h1>
    <div class="contato">Contato: 84 99809-6865</div>
  </div>

  <h2 style="text-align: center;">ORDEM DE SERVIÇO</h2>

  <div class="linha">
    <div class="col">
      <label>OS Nº</label>
      <span id="osNumber"></span>
    </div>
  </div>

  <div class="linha">
    <div class="col col-nome">
      <label>NOME</label>
      <input type="text" id="nomeCliente" />
    </div>
  </div>

  <div class="linha">
    <div class="col" style="flex: 0.5;">
      <label>TELEFONE</label>
      <input type="text" id="telefone" />
    </div>
    <div class="col" style="flex: 0.3;">
      <label class="checkbox-inline">
        <input type="checkbox" id="whatsapp" /> WHATSAPP
      </label>
    </div>
    <div class="col">
      <label>TÉCNICO RESPONSÁVEL</label>
      <select id="tecnico">
        <option value="">Selecione</option>
        <option>JOÃO PAULO AVELINO</option>
        <option>BRUNO SANTOS</option>
      </select>
    </div>
  </div>

  <div class="linha">
    <div class="col">
      <label>MARCA / MODELO</label>
      <input type="text" id="marcaModelo" />
    </div>
  </div>

  <div class="linha">
    <div class="col">
      <label>ACESSÓRIO</label>
      <label class="checkbox-inline"><input type="checkbox" id="acessorioSim" /> SIM</label>
      <label class="checkbox-inline"><input type="checkbox" id="acessorioNao" /> NÃO</label>
    </div>

    <div class="col">
      <label>LIGA</label>
      <label class="checkbox-inline"><input type="checkbox" id="ligaSim" /> SIM</label>
      <label class="checkbox-inline"><input type="checkbox" id="ligaNao" /> NÃO</label>
    </div>

    <div class="col">
      <label>DEFEITO FÍSICO</label>
      <label class="checkbox-inline"><input type="checkbox" id="defeitoSim" /> SIM</label>
      <label class="checkbox-inline"><input type="checkbox" id="defeitoNao" /> NÃO</label>
    </div>
  </div>

  <div class="linha hidden" id="qualAcessorioLinha">
    <div class="col">
      <label>QUAL ACESSÓRIO</label>
      <input type="text" id="qualAcessorio" />
    </div>
  </div>

  <div class="linha hidden" id="qualDefeitoLinha">
    <div class="col">
      <label>QUAL DEFEITO</label>
      <input type="text" id="qualDefeito" />
    </div>
  </div>

  <div class="linha">
    <div class="col" style="flex: 100%;">
      <label>DEFEITO RELATADO PELO CLIENTE</label>
      <textarea rows="4" id="defeitoCliente"></textarea>
    </div>
  </div>

  <div class="linha">
    <div class="col">
      <label>ENTRADA EM</label>
      <span id="dataEntrada"></span>
    </div>
    <div class="col">
      <label>SAÍDA EM</label>
      <input type="text" id="dataSaida" placeholder="__/__/____" />
    </div>
  </div>

  <div class="linha">
    <div class="col">
      <label>ASSINATURA DO CLIENTE</label>
      <input type="text" id="assinaturaCliente" />
    </div>
    <div class="col">
      <label>ASSINATURA DO TÉCNICO</label>
      <input type="text" id="assinaturaTecnico" />
    </div>
  </div>

  <div class="linha">
    <div class="col">
      <label>SENHA</label>
      <input type="text" id="senha" />
    </div>
  </div>

  <hr />

  <div class="linha termos-condicoes" style="display:none;">
    <div class="col" style="flex: 100%;">
      <h3>Termos e Condições de Serviço</h3>
      <p>
        <strong>Recebimento do Equipamento:</strong> O equipamento entregue será avaliado, registrando estado físico, avarias e acessórios recebidos.
        Não nos responsabilizamos por itens não declarados.
      </p>
      <p>
        <strong>Diagnóstico e Orçamento:</strong> O diagnóstico será realizado em até 3 dias úteis. O serviço só será iniciado após aprovação do orçamento pelo cliente.
      </p>
      <p>
        <strong>Garantia:</strong> Garantia de 90 dias para o serviço realizado, limitada ao reparo efetuado.
        Não cobre mau uso, quedas, líquidos ou intervenções de terceiros.
      </p>
      <p>
        <strong>Prazo e Retirada:</strong> O cliente deve retirar o equipamento em até 30 dias após a conclusão do serviço.
        Após esse período, poderemos cobrar taxa de armazenamento.
      </p>
    </div>
  </div>

  <button class="btn print-btn" onclick="window.print()">
    <svg viewBox="0 0 24 24"><path d="M6 9H18V15H6zM6 5H18V7H6zM6 17H18V19H6z"/></svg>
    IMPRIMIR ORDEM
  </button>

  <script>
    // Função para gerar e preencher OS e data ao carregar
    function preencherDataEIncrementarOS() {
      const hoje = new Date();
      const dataFormatada = hoje.toLocaleDateString('pt-BR');

      document.getElementById('dataEntrada').textContent = dataFormatada;

      // Recuperar último número OS do localStorage ou inicializar
      let osAtual = parseInt(localStorage.getItem('osAtual') || '0', 10);
      osAtual++;
      localStorage.setItem('osAtual', osAtual);
      document.getElementById('osNumber').textContent = osAtual;

      // Limpar formulário para nova OS
      limparFormulario();
    }

    function limparFormulario() {
      document.getElementById('nomeCliente').value = '';
      document.getElementById('telefone').value = '';
      document.getElementById('whatsapp').checked = false;
      document.getElementById('tecnico').value = '';
      document.getElementById('marcaModelo').value = '';
      document.getElementById('acessorioSim').checked = false;
      document.getElementById('acessorioNao').checked = false;
      document.getElementById('ligaSim').checked = false;
      document.getElementById('ligaNao').checked = false;
      document.getElementById('defeitoSim').checked = false;
      document.getElementById('defeitoNao').checked = false;
      document.getElementById('qualAcessorio').value = '';
      document.getElementById('qualDefeito').value = '';
      document.getElementById('qualAcessorioLinha').style.display = 'none';
      document.getElementById('qualDefeitoLinha').style.display = 'none';
      document.getElementById('defeitoCliente').value = '';
      document.getElementById('dataSaida').value = '';
      document.getElementById('assinaturaCliente').value = '';
      document.getElementById('assinaturaTecnico').value = '';
      document.getElementById('senha').value = '';
    }

    // Mostrar campos qual acessório e qual defeito conforme checkbox
    document.getElementById('acessorioSim').addEventListener('change', () => {
      document.getElementById('qualAcessorioLinha').style.display = document.getElementById('acessorioSim').checked ? 'block' : 'none';
      if (!document.getElementById('acessorioSim').checked) document.getElementById('qualAcessorio').value = '';
      if (document.getElementById('acessorioSim').checked) document.getElementById('acessorioNao').checked = false;
    });
    document.getElementById('acessorioNao').addEventListener('change', () => {
      if (document.getElementById('acessorioNao').checked) {
        document.getElementById('acessorioSim').checked = false;
        document.getElementById('qualAcessorioLinha').style.display = 'none';
        document.getElementById('qualAcessorio').value = '';
      }
    });

    document.getElementById('defeitoSim').addEventListener('change', () => {
      document.getElementById('qualDefeitoLinha').style.display = document.getElementById('defeitoSim').checked ? 'block' : 'none';
      if (!document.getElementById('defeitoSim').checked) document.getElementById('qualDefeito').value = '';
      if (document.getElementById('defeitoSim').checked) document.getElementById('defeitoNao').checked = false;
    });
    document.getElementById('defeitoNao').addEventListener('change', () => {
      if (document.getElementById('defeitoNao').checked) {
        document.getElementById('defeitoSim').checked = false;
        document.getElementById('qualDefeitoLinha').style.display = 'none';
        document.getElementById('qualDefeito').value = '';
      }
    });

    // Liga checkbox exclusividade similar
    document.getElementById('ligaSim').addEventListener('change', () => {
      if (document.getElementById('ligaSim').checked) {
        document.getElementById('ligaNao').checked = false;
      }
    });
    document.getElementById('ligaNao').addEventListener('change', () => {
      if (document.getElementById('ligaNao').checked) {
        document.getElementById('ligaSim').checked = false;
      }
    });

    // Ao imprimir, salva a OS no histórico
    window.onbeforeprint = function() {
      salvarOSNoHistorico();
    };

    // Salvar a OS completa no histórico localStorage
    function salvarOSNoHistorico() {
      const osNumber = document.getElementById('osNumber').textContent;
      const dataEntrada = document.getElementById('dataEntrada').textContent;

      const osDados = {
        osNumber,
        dataEntrada,
        nomeCliente: document.getElementById('nomeCliente').value,
        telefone: document.getElementById('telefone').value,
        whatsapp: document.getElementById('whatsapp').checked,
        tecnico: document.getElementById('tecnico').value,
        marcaModelo: document.getElementById('marcaModelo').value,
        acessorioSim: document.getElementById('acessorioSim').checked,
        acessorioNao: document.getElementById('acessorioNao').checked,
        ligaSim: document.getElementById('ligaSim').checked,
        ligaNao: document.getElementById('ligaNao').checked,
        defeitoSim: document.getElementById('defeitoSim').checked,
        defeitoNao: document.getElementById('defeitoNao').checked,
        qualAcessorio: document.getElementById('qualAcessorio').value,
        qualDefeito: document.getElementById('qualDefeito').value,
        defeitoCliente: document.getElementById('defeitoCliente').value,
        dataSaida: document.getElementById('dataSaida').value,
        assinaturaCliente: document.getElementById('assinaturaCliente').value,
        assinaturaTecnico: document.getElementById('assinaturaTecnico').value,
        senha: document.getElementById('senha').value,
        timestamp: new Date().getTime()
      };

      let historico = JSON.parse(localStorage.getItem('historicoOS') || '[]');

      // Remove OS antiga do mesmo número para evitar duplicidade
      historico = historico.filter(item => item.osNumber !== osNumber);

      // Adiciona nova
      historico.push(osDados);

      // Mantém só 90 dias (timestamp)
      const limite = new Date();
      limite.setDate(limite.getDate() - 90);
      historico = historico.filter(item => item.timestamp >= limite.getTime());

      localStorage.setItem('historicoOS', JSON.stringify(historico));
    }

    // Abrir popup histórico
    function abrirHistorico() {
      const popup = document.getElementById('historicoPopup');
      const lista = document.getElementById('listaHistorico');
      lista.innerHTML = '';

      let historico = JSON.parse(localStorage.getItem('historicoOS') || '[]');

      // Ordena decrescente pela OS (mais recente primeiro)
      historico.sort((a, b) => b.osNumber - a.osNumber);

      if (historico.length === 0) {
        lista.innerHTML = '<p>Nenhuma OS encontrada no histórico.</p>';
      } else {
        historico.forEach(item => {
          const div = document.createElement('div');
          div.textContent = `OS Nº ${item.osNumber} - ${item.dataEntrada} - ${item.nomeCliente}`;
          div.title = "Clique para carregar esta OS";
          div.style.userSelect = "none";
          div.addEventListener('click', () => {
            carregarOS(item);
            fecharHistorico();
          });
          lista.appendChild(div);
        });
      }
      popup.style.display = 'block';
    }

    function fecharHistorico() {
      document.getElementById('historicoPopup').style.display = 'none';
    }

    // Carregar OS no formulário para edição
    function carregarOS(osDados) {
      document.getElementById('osNumber').textContent = osDados.osNumber;
      document.getElementById('dataEntrada').textContent = osDados.dataEntrada;

      document.getElementById('nomeCliente').value = osDados.nomeCliente || '';
      document.getElementById('telefone').value = osDados.telefone || '';
      document.getElementById('whatsapp').checked = !!osDados.whatsapp;
      document.getElementById('tecnico').value = osDados.tecnico || '';
      document.getElementById('marcaModelo').value = osDados.marcaModelo || '';
      document.getElementById('acessorioSim').checked = !!osDados.acessorioSim;
      document.getElementById('acessorioNao').checked = !!osDados.acessorioNao;
      document.getElementById('ligaSim').checked = !!osDados.ligaSim;
      document.getElementById('ligaNao').checked = !!osDados.ligaNao;
      document.getElementById('defeitoSim').checked = !!osDados.defeitoSim;
      document.getElementById('defeitoNao').checked = !!osDados.defeitoNao;

      document.getElementById('qualAcessorioLinha').style.display = osDados.acessorioSim ? 'block' : 'none';
      document.getElementById('qualAcessorio').value = osDados.qualAcessorio || '';

      document.getElementById('qualDefeitoLinha').style.display = osDados.defeitoSim ? 'block' : 'none';
      document.getElementById('qualDefeito').value = osDados.qualDefeito || '';

      document.getElementById('defeitoCliente').value = osDados.defeitoCliente || '';
      document.getElementById('dataSaida').value = osDados.dataSaida || '';
      document.getElementById('assinaturaCliente').value = osDados.assinaturaCliente || '';
      document.getElementById('assinaturaTecnico').value = osDados.assinaturaTecnico || '';
      document.getElementById('senha').value = osDados.senha || '';
    }
  </script>

</body>
</html>
